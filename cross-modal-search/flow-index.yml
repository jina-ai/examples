!Flow
with:
  prefetch: 10
pods:
  loader:
    uses: yaml/image_load.yml
    parallel: $PARALLEL
    read_only: true
  normalizer:
    uses: yaml/image_normalize.yml
    parallel: $PARALLEL
    read_only: true
  image_encoder:
    uses: docker://jinahub/pod.encoder.vseimageencoder:0.0.4-0.9.13
    parallel: $PARALLEL
    timeout_ready: 600000
    read_only: true
  image_vector_indexer:
    uses: yaml/index-image-vector.yml
    polling: ANY
    shards: $SHARDS
    separated_workspace: true
  image_kv_indexer:
    uses: yaml/index-image-kv.yml
    polling: ANY
    shards: $SHARDS
    separated_workspace: true
    needs: [gateway]
  text_encoder:
    uses: docker://jinahub/pod.encoder.vsetextencoder:0.0.3-0.9.13
    uses_internal: yaml/text_encoder.yml
    parallel: $PARALLEL
    timeout_ready: 600000
    read_only: true
    needs: [gateway]
  text_indexer:
    uses: yaml/index-text.yml
    polling: ANY
    shards: $SHARDS
    separated_workspace: true
  join_all:
    uses: _merge
    needs: [image_vector_indexer, image_kv_indexer, text_indexer]
    read_only: true