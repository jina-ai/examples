!Flow
version: '1'
with:
  prefetch: 10
pods:
  - name: loader
    uses: yaml/image-load.yml
    parallel: $PARALLEL
    read_only: true
  - name: normalizer
    uses: yaml/image-normalize.yml
    parallel: $PARALLEL
    read_only: true
  - name: image_encoder
    uses: $JINA_USES_VSE_IMAGE_ENCODER
    parallel: $PARALLEL
    timeout_ready: 600000
    read_only: true
  - name: image_vector_indexer
    uses: yaml/index-image-vector.yml
  - name: image_kv_indexer
    uses: yaml/index-image-kv.yml
    needs: [gateway]
  - name: text_encoder
    uses: $JINA_USES_VSE_TEXT_ENCODER
    uses_internal: yaml/text-encoder.yml
    parallel: $PARALLEL
    timeout_ready: 600000
    read_only: true
    needs: [gateway]
  - name: text_indexer
    uses: yaml/index-text.yml
  - name: join_all
    uses: _merge
    needs: [image_vector_indexer, image_kv_indexer, text_indexer]
    read_only: true